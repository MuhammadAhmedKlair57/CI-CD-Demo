name: CI/CD Showcase - Bootstrap Landing Page

# Triggers the workflow on push/PR to main/master
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  # Allows manual trigger from GitHub UI (great for live demo)
  workflow_dispatch:

# Prevents multiple deployments running at once (clean demo)
concurrency:
  group: ci-cd-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # JOB 1: Quality Checks (CI phase)
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  quality-checks:
    name: Quality & Validation Checks
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      # Validates HTML5 syntax (catches broken markup)
      - name: ğŸ” Validate HTML syntax
        uses: Cyb3r-Jak3/html5validator-action@v7.2.0
        with:
          root: .

      # Checks broken links, images, CDNs etc.
      - name: ğŸ”— Check for broken links & resources
        uses: lycheeverse/lychee-action@v2
        with:
          args: >-
            --verbose
            --no-progress
            --max-concurrency 12
            --timeout 40
            --accept 200,301,302,403,429
            index.html
          fail: true   # Strict mode - fails job on broken resources

      # Optional: you can add more checks here later (e.g. accessibility, CSS lint)

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  # JOB 2: Deployment (CD phase) - only on main branch push
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  deploy:
    name: Deploy to GitHub Pages
    needs: quality-checks           # Only runs if CI passes
    if: github.ref == 'refs/heads/main'   # Skip on PRs
    runs-on: ubuntu-latest

    permissions:
      pages: write
      id-token: write

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸš€ Upload static content as artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: .                     # Deploy everything in root (index.html + assets)

      - name: ğŸŒ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
